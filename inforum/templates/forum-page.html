{% extends 'base.html' %}

{% block meta %}
<title>{{forum.fields.title}}</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/daisyui@2.33.0/dist/full.css" rel="stylesheet" type="text/css" />
{% endblock meta %}

{% block content %}
<main class="max-w-screen min-h-screen flex flex-col items-center justify-start bg-gray-50">
    <article id="forum-card-placeholder" class=" max-w-5xl mx-4">
    </article>

    <section>
    </section>   
</main>
<script>
    function createForumCard(forum){
        const colorPallete = {
            technology : 'bg-blue-500',
            business : "bg-amber-500",
            startup : "bg-green-600",
            misc : "bg-gray-400"
        }
        var placeholder = $("#forum-card-placeholder");
        placeholder.append(
                `<div id="forum-${forum.pk}" id="forum-${forum.pk}" class="my-3 card rounded-sm min-h-[400px] w-full lg:w-[800px] bg-base-100 cursor-pointer shadow-md">
                    <div class="h-full w-[3px] ${colorPallete[forum.fields.category.toLowerCase()]} absolute"></div>
                        <div class="card-body p-4 md:p-6 relative">
                            <h2 class="card-title text-[18px] md:text-xl">${forum.fields.title}</h2>
                            <div class="h-full ">
                                <p class="leading-none font-bold text-gray-600 text-base mb-6">${forum.fields.username} <span class="font-normal ml-3">${forum.fields.time_created}</span></p>
                                <p class='text-[15px] flex flex-col flex-wrap multi-line'>${forum.fields.content} 
                                </p>
                            </div>
                        </div>
                        <div id="comment-form" class="w-full p-4 bg-white relative" >
                        <input id="comment" class="w-full border rounded-full p-2 pl-4 pr-14 bg-gray-100 placeholder-gray-400 focus:ring-blue-500 " placeholder="leave a reply"></input>
                        <button onclick="submitHandler()" id="submit-comment"  class="absolute h-6 w-6 top-6 right-8" >
                            <img  src="../../static/assets/send-icon.svg"/>
                        </button>
                    </div>
                    </div>
                </div>`
                )
    }

    $(window).ready(function(){
        $.get("/inforum/get_forum/{{forum_id}}", function(data) {
            createForumCard(data[0]);
        })
        $.get("/inforum/forum/comment/{{forum_id}}", function(data) {
            console.log(data);
        })
    })
   
    function submitHandler(){
        comment = $("#comment")["0"];
        console.log(comment)
        const cleanData = {
            "csrfmiddlewaretoken" : "{{csrf_token}}",
            "comment" : comment.value,
        }
        
        $.ajax({
        type: "POST",
        url: "/inforum/forum/{{forum_id}}/comment/add",
        //contentType: "application/json; charset=utf-8",
        data:cleanData,
        success: () => {
            
           comment.value="";
            
        },
        dataType: "json"
        });
    }
   
    $("#submit-comment").click(function(e){
        e.preventDefault();
        console.log(e);
   })
        
        


</script>

{% endblock content %}